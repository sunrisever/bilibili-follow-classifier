# -*- coding: utf-8 -*-
"""
B站关注UP主分类脚本 V3
基于详细数据（合集、系列、视频标题、标签）进行智能分类
"""

import json
import re
from pathlib import Path
from collections import Counter

base_path = Path(__file__).parent
data_path = base_path / "data"

# 读取详细数据
with open(data_path / "up主详细数据.json", "r", encoding="utf-8") as f:
    uploaders = json.load(f)

print(f"加载 {len(uploaders)} 个UP主数据")

# ========== 分类体系 ==========
CATEGORIES = [
    "考研",
    "AI学术/论文",
    "AI产品/开源/新闻",
    "AI网课/教程",
    "编程/计算机",
    "数学/物理",
    "数码/科技/汽车",
    "电气/电子/自动化",
    "时政/地缘政治",
    "财经/金融",
    "科普/人文",  # 合并：科普+科普/人文（不含时政）
    "形象提升/医美",
    "两性情感",
    "户外探索",
    "美食/探店",
    "音乐/乐器",
    "影视/动漫",
    "医学/健康",
    "校园生活/校园日常",  # 含：大学官方号、学习陪伴、效率工具
    "美女/颜值",
    "生活",  # 默认分类
]

# ========== 手动指定（优先级最高）==========
MANUAL = {
    # ===== 时政 =====
    "蔡正元博士": "时政/地缘政治",
    "张维为": "时政/地缘政治",
    "观察者网": "时政/地缘政治",
    "央视新闻": "时政/地缘政治",
    "新华社": "时政/地缘政治",
    "冰汝看美国": "时政/地缘政治",

    # ===== 大学官方号 → 校园生活 =====
    "上海交通大学": "校园生活/校园日常",
    "清华大学": "校园生活/校园日常",
    "北京大学": "校园生活/校园日常",
    "浙江大学": "校园生活/校园日常",
    "中国科学院大学": "校园生活/校园日常",
    "北大前沿计算研究中心": "校园生活/校园日常",
    "复旦大学": "校园生活/校园日常",

    # ===== 清华AIR → AI学术 =====
    "清华大学智能产业院": "AI学术/论文",

    # ===== 数学/物理类 =====
    "清华大学答疑坊": "数学/物理",
    "ZY-Eric": "数学/物理",
    "离散的世界": "数学/物理",
    "我是小小魏w": "数学/物理",  # 北航工科数分助教

    # ===== 科普/人文类 =====
    "中气爱mini": "科普/人文",  # 天气/气象
    "中气爱": "科普/人文",  # 天气/气象

    # ===== 效率工具 → 校园生活 =====
    "加州理工Amy_Wang": "校园生活/校园日常",  # 学习方法
    "Sophie潘潘": "校园生活/校园日常",  # 职业发展、个人成长

    # ===== 考研 =====
    "Stat_DSX": "考研",

    # ===== 考研区修正（移出）=====
    "三十岁退休了": "财经/金融",  # FIRE提前退休
    "李永乐老师官方": "科普/人文",  # 小学数学/物理、科普为主
    "北斗导航Compass": "生活",  # 流体力学但视频杂谈
    "猴博士爱讲课": "数学/物理",  # 期末复习为主
    "宋浩老师官方": "数学/物理",  # 专升本+大学数学/物理
    "哔哩哔哩课堂": "生活",  # B站官方课堂平台
    "高数小酒馆": "数学/物理",  # 高数教学
    "梦言人生": "数学/物理",  # 数学/物理物理教学
    "Aki请好好学习": "校园生活/校园日常",  # 北大读研vlog

    # ===== 美女/颜值类 =====
    "王六堡": "美女/颜值",
    "沛沛瑶呀爱吃糖呀": "美女/颜值",
    "伢伢gagako": "美女/颜值",
    "-童锣烧_": "美女/颜值",
    "甜粥粥-": "美女/颜值",
    "奶兔星球qvq": "美女/颜值",
    "雨筠jun": "美女/颜值",
    "羊羔哞": "美女/颜值",
    "是马铃薯大王": "美女/颜值",
    "幺玖伍195": "美女/颜值",
    "叫我胖大星先生": "美女/颜值",
    "铁板欧尼酱": "美女/颜值",
    "合欢宗招生办校长": "影视/动漫",  # 凡人修仙传动漫二创
    "予熹乐": "美女/颜值",
    "小慧在学习吗": "美女/颜值",  # 美女陪伴学习
    "开心一点啦123": "美女/颜值",  # 美国留子美女
    "梨花小师妹": "美女/颜值",
    "芝士小鱼饼饼": "美女/颜值",
    "一颗小花生y": "美女/颜值",
    "濛雨清波": "美女/颜值",
    "一里ouo": "美女/颜值",  # 颜值向cos内容
    "灰宝儿honster": "美女/颜值",  # 美女试穿

    # ===== AI学术/论文 =====
    "PaperWeekly": "AI学术/论文",
    "ReadPaper论文阅读": "AI学术/论文",
    "AITIME论道": "AI学术/论文",
    "CVer计算机视觉": "AI学术/论文",
    "人工智能前沿讲习": "AI学术/论文",
    "南京大学NLP研究组": "AI学术/论文",
    "计算机视觉与人工智能": "AI学术/论文",
    "FAI-Seminar": "AI学术/论文",
    "周博磊": "AI学术/论文",
    "张伟楠SJTU": "AI学术/论文",
    "许华哲Harry": "AI学术/论文",
    "漫士沉思录": "AI学术/论文",
    "RLChina强化学习社区": "AI学术/论文",
    "X-LANCE实验室": "AI学术/论文",
    "上交CyPhy实验室": "AI学术/论文",
    "上交IWIN-FINS实验室": "AI学术/论文",
    "上交大DAI实验室": "AI学术/论文",
    "上海交大CIUS实验室": "AI学术/论文",
    "上海交大ViSYS实验室": "AI学术/论文",
    "上海交通大学IPADS": "AI学术/论文",
    "华南理工大学MetaEvo": "AI学术/论文",
    "中科院自动化所": "AI学术/论文",
    "PKU-DCAI": "AI学术/论文",
    "极市平台": "AI学术/论文",
    "正合时宜": "AI学术/论文",  # 英伟达机器人博士
    "穆尧在交大CS": "AI学术/论文",  # 上交博导，具身智能

    # ===== AI产品/开源/新闻 =====
    "量子位": "AI产品/开源/新闻",
    "机器之心": "AI产品/开源/新闻",
    "硅谷101": "AI产品/开源/新闻",
    "硅谷101播客": "AI产品/开源/新闻",
    "晚点LatePost": "AI产品/开源/新闻",
    "晚点聊LateTalk": "AI产品/开源/新闻",
    "钛媒体APP": "AI产品/开源/新闻",
    "红杉汇": "AI产品/开源/新闻",
    "稚晖君": "AI产品/开源/新闻",
    "Unitree宇树科技": "AI产品/开源/新闻",
    "智元AGIBOT": "AI产品/开源/新闻",
    "U航-首形科技": "AI产品/开源/新闻",
    "NVIDIA英伟达": "AI产品/开源/新闻",
    "Google中国": "AI产品/开源/新闻",
    "阿里云": "AI产品/开源/新闻",
    "阿里达摩院扫地僧": "AI产品/开源/新闻",
    "世界人工智能大会": "AI产品/开源/新闻",
    "智猩猩": "AI产品/开源/新闻",
    "AI进化论-花生": "AI产品/开源/新闻",
    "知遥玩AI": "AI产品/开源/新闻",
    "差评君": "AI产品/开源/新闻",
    "酷玩实验室": "AI产品/开源/新闻",
    "MiniMax_稀宇极智": "AI产品/开源/新闻",
    "Manus官方": "AI产品/开源/新闻",
    "青稞社区": "AI产品/开源/新闻",
    "直男山禾": "AI产品/开源/新闻",  # AI用法分享
    "产品君": "AI产品/开源/新闻",  # AI产品经理
    "这里是好AI啊": "AI产品/开源/新闻",  # AI视频教程

    # ===== AI网课/教程 =====
    "跟李沐学AI": "AI网课/教程",
    "同济子豪兄": "AI网课/教程",
    "古月居GYH": "AI网课/教程",
    "吴恩达深度学习": "AI网课/教程",
    "吴恩达-深度学习": "AI网课/教程",
    "吴恩达AI课程研究院": "AI网课/教程",
    "吴恩达AndrewNg": "AI网课/教程",
    "吴恩达机器学习_AndrewNg": "AI网课/教程",
    "李宏毅-机器学习": "AI网课/教程",
    "deeplearning_ai": "AI网课/教程",
    "深蓝学院": "AI网课/教程",
    "我是土堆": "AI网课/教程",
    "刘二大人": "AI网课/教程",
    "迪哥AI课堂": "AI网课/教程",
    "贝塔AI真想教会你": "AI网课/教程",
    "莫烦Python": "AI网课/教程",
    "赵虚左": "AI网课/教程",
    "Autolabor官方": "AI网课/教程",
    "ZOMI酱": "AI网课/教程",
    "秋刀鱼的炼丹工坊": "AI网课/教程",
    "Bubbliiiing": "AI网课/教程",
    "麻瓜AI进修所": "AI网课/教程",
    "Sa神带你学AI": "AI网课/教程",
    "cici算法屋": "AI网课/教程",
    "五道口纳什": "AI网课/教程",  # LLM架构教程

    # ===== 美食/探店 =====
    "盗月社食遇记": "美食/探店",
    "食贫道": "美食/探店",
    "特厨隋卞": "美食/探店",
    "特厨隋坡": "美食/探店",
    "真探唐仁杰": "美食/探店",
    "老王在中国": "美食/探店",

    # ===== 音乐/乐器 =====
    "Animenzzz": "音乐/乐器",
    "Cello纳多": "音乐/乐器",
    "Cuppix_": "音乐/乐器",
    "Vinheteiro": "音乐/乐器",
    "oskarpianist": "音乐/乐器",
    "不会弹琴的歌者": "音乐/乐器",
    "降B_大调": "音乐/乐器",
    "黄霄雲": "音乐/乐器",
    "卡布叻_周深": "音乐/乐器",
    "杰威尔音乐": "音乐/乐器",
    "Fish_饼餅": "音乐/乐器",  # 韩团Vocal分析

    # ===== 影视/动漫 =====
    "木鱼水心": "影视/动漫",
    "虫子说电影": "影视/动漫",
    "神影厅长": "影视/动漫",
    "迷影区间": "影视/动漫",
    "世界需要恐怖片": "影视/动漫",
    "浮泽动漫协会": "影视/动漫",

    # ===== 医学/健康 =====
    "医学边界": "医学/健康",
    "尹烨": "医学/健康",
    "医学科普联盟": "医学/健康",
    "兔叭咯": "医学/健康",
    "皮科医生魏小博": "医学/健康",
    "营养师顾中一": "医学/健康",
    "中医Lynia": "医学/健康",
    "人体科学": "医学/健康",
    "卓叔增重": "医学/健康",
    "北美运动学博士Bruce_PhD": "医学/健康",

    # ===== 校园生活/学习陪伴 =====
    "瓶子的学习漂流记": "校园生活/校园日常",
    "张畅畅": "校园生活/校园日常",
    "发福小黄": "校园生活/校园日常",
    "M0esfet": "校园生活/校园日常",
    "派大叔的小星星": "校园生活/校园日常",
    "出出要按时毕业": "校园生活/校园日常",
    "星悦小美女PKU": "校园生活/校园日常",

    # ===== 户外探索 =====
    "小鹿Lawrence": "户外探索",
    "米老师呀": "户外探索",
    "中国国家地理": "户外探索",
    "中国国家地理景观": "户外探索",
    "Linksphotograph": "户外探索",
    "神秘园": "户外探索",
    "呵呵的旅行日志": "户外探索",
    "Jasmine茉莉与冰川": "户外探索",
    "阅路山": "户外探索",
    "阅路山-小岩呐": "户外探索",
    "中国探险协会": "户外探索",
    "星球研究所": "户外探索",
    "OK哥环球探海记": "户外探索",

    # ===== 数码/科技/汽车 =====
    "老师好我叫何同学": "数码/科技/汽车",
    "影视飓风": "数码/科技/汽车",

    # ===== 数学/物理 =====
    "分析学爱好者": "数学/物理",
    "3Blue1Brown": "数学/物理",
    "交大姚老师": "数学/物理",
    "SJTU抽象代数": "数学/物理",
    "线代铜": "数学/物理",
    "无尽沙砾": "数学/物理",
    "分析学玩家": "数学/物理",
    "毕的二阶导": "数学/物理",

    # ===== 考研 =====
    "宋浩老师官方": "考研",
    "猴博士爱讲课": "考研",
    "没咋了": "考研",
    "大鱼考研竞赛数学/物理": "考研",
    "考研政治徐涛": "考研",
    "考研政治陆寓丰老师": "考研",
    "考研政治广智老师": "考研",
    "张宇考研数学/物理": "考研",
    "考研数学/物理武忠祥老师": "考研",
    "李永乐考研团队": "考研",

    # ===== 编程/计算机 =====
    "上海交大计算机学院": "编程/计算机",
    "慕课网官方账号": "编程/计算机",
    "边亮_网络安全": "编程/计算机",
    "程序员鱼皮": "编程/计算机",
    "代码随想录": "编程/计算机",
    "黑马程序员": "编程/计算机",
    "尚硅谷": "编程/计算机",

    # ===== 财经/金融 =====
    "巫师财经": "财经/金融",
    "小Lin说": "财经/金融",
    "小Lin竖着说": "财经/金融",
    "投研部杨摸鱼": "财经/金融",
    "酷温Coolwin": "财经/金融",
    "每日搞钱信息差": "财经/金融",  # 创业、副业
    "张小珺商业访谈录": "财经/金融",  # AI商业访谈
    "科工洞洞拐": "财经/金融",  # 科工产业分析

    # ===== 两性情感 =====
    "祝你娶个中国女孩": "两性情感",
    "借我300去洗牙": "两性情感",

    # ===== 电气/电子/自动化 =====
    "机器人科学与技术": "电气/电子/自动化",
    "爱上半导体": "电气/电子/自动化",
    "RM云汉交龙战队": "电气/电子/自动化",  # RoboMaster机器人战队

    # ===== 生活（其他）=====
    "小羊在鲜花舍": "生活",
    "歪果仁研究协会": "生活",
    "NGA杂谈": "生活",
    "历史调研室": "科普/人文",
    "云视听小电视-TV": "生活",  # B站TV官方号
    "腾讯招聘": "生活",  # 腾讯招聘官方

    # ===== 动漫/影视 =====
    "梵人凡语": "影视/动漫",  # 凡人修仙传有声小说解说

    # ===== 美女/颜值（从生活移入）=====
    "佳茗": "美女/颜值",  # 二次元情侣内容
    "-欣小萌-": "美女/颜值",  # cos内容
    "卡顿的柚子": "美女/颜值",  # 形象相关

    # ===== 校园生活（从生活移入）=====
    "小丁给我大大方方的": "校园生活/校园日常",  # 大二vlog
    "菜菜叶_": "校园生活/校园日常",  # AI博士读博日常
    "锦堂生活空间": "校园生活/校园日常",  # 清华大学学生
    "猫哥mao": "校园生活/校园日常",  # 麻省理工学生
    "YChxxy_": "校园生活/校园日常",  # 留学生生活
    "Naaana_": "校园生活/校园日常",  # 大学生日记
    "withLaura": "户外探索",  # 打工人旅行
    "Zhan丨": "校园生活/校园日常",  # 对抗焦虑、个人成长

    # ===== 新增修正（生活类审核）=====
    "柳秘书不瞎说": "财经/金融",  # 金融圈评论
    "极速拍档-Jacky": "数码/科技/汽车",  # 汽车测评
    "十七岁歌手想打中单": "科普/人文",  # 纪录片人文
    "每天都想吃小鱼干": "美女/颜值",  # 舞蹈穿搭美女
    "1350亿光年": "户外探索",  # 旅行航拍

    # ===== 校园生活类修正 =====
    "Jinny硅谷职场日记": "AI产品/开源/新闻",  # 硅谷AI研究员
    "北斗导航Compass": "考研",  # 流体力学学习

    # ===== 形象提升/医美（从美女移入）=====
    "鼻整形医生刘喆骐": "形象提升/医美",  # 鼻整形
    "十一的看脸日记": "形象提升/医美",  # 形象设计
    "大沛沛沛吖": "形象提升/医美",  # 形象美学

    # ===== 其他修正 =====
    "难落-": "数码/科技/汽车",  # 摄影教学
    "叫我胖大星先生": "户外探索",  # 环游世界
    "焕哥ya": "校园生活/校园日常",  # 浙大计算机研1跳舞
    "甜粥粥-": "校园生活/校园日常",  # 南大本科交大硕士
    "雨荷已渡苇烟": "校园生活/校园日常",  # 研究生组会vlog
    "绩效哥": "生活",  # 高考填报志愿等杂谈
    "我要一米八了": "电气/电子/自动化",  # 智能机器人/移动平台导航
    "Saury不爱吃鱼": "校园生活/校园日常",  # 04美术生大三
    "o芋圆啵啵o": "校园生活/校园日常",  # 清华本硕大厂程序员

    # ===== 数码/科技/汽车修正 =====
    "利利川": "科普/人文",  # 历史人文纪录片
    "小艾大叔": "生活",  # 豪宅探访
    "峰哥亡命天涯": "两性情感",  # 两性情感类
    "硬核的半佛仙人": "财经/金融",  # 财经评论
    "JLRS-LeoFM": "音乐/乐器",  # 音乐相关
    "本猪小猪": "美女/颜值",  # 美女UP主，做山西菜

    # ===== 科普区修正 =====
    "鸭大坑导": "编程/计算机",  # 操作系统网课
    "薛定谔的兔女郎": "数学/物理",  # 物理学习类（物理放数学/物理大类）
    "Ayumu爱讲数学/物理": "数学/物理",  # 数学/物理UP
    "Science科学杂志": "AI学术/论文",  # 科学期刊
    "Solara570": "数学/物理",  # 数学/物理类
    "漫士沉思录": "数学/物理",  # 数学/物理类
    "毕导": "校园生活/校园日常",  # 清华博士科普
    "糖果果的未来要发光": "生活",  # 生活类

    # ===== 科普/人文区修正（时政不是历史）=====
    "斯奎奇大王": "时政/地缘政治",  # 时政类
    "王骁Albert": "时政/地缘政治",  # 国际政治
    "唐迟老师": "考研",  # 考研英语阅读
    "轨迹球TRACKBALL": "科普/人文",  # 科普类
    "是知识呀": "科普/人文",  # 科普类
    "科普中国": "科普/人文",  # 科普类
}

# ========== 关键词规则（带权重）==========
KEYWORD_RULES = {
    "考研": [
        ("考研", 10), ("研究生", 5), ("保研", 8), ("上岸", 6),
        ("复试", 8), ("408", 10), ("826", 10), ("王道", 8), ("天勤", 8),
        ("肖秀荣", 10), ("肖四", 10), ("肖八", 10), ("腿姐", 10),
        ("徐涛", 8), ("张宇", 6), ("武忠祥", 8), ("李永乐", 5),
        ("660题", 10), ("1000题", 10), ("1800题", 10), ("30讲", 8),
        ("真题", 5), ("模拟卷", 8), ("押题", 8),
    ],
    "AI学术/论文": [
        ("论文", 8), ("paper", 8), ("arxiv", 10), ("顶会", 10),
        ("CVPR", 10), ("NeurIPS", 10), ("ICML", 10), ("ICLR", 10),
        ("ACL", 10), ("EMNLP", 10), ("AAAI", 10), ("IJCAI", 10),
        ("实验室", 6), ("研究组", 8), ("seminar", 8), ("讲座", 5),
    ],
    "AI产品/开源/新闻": [
        ("开源", 8), ("github", 8), ("产品", 5), ("发布", 5),
        ("融资", 8), ("创业", 6), ("估值", 8), ("商业", 5),
        ("新闘", 5), ("资讯", 5), ("动态", 4), ("科技媒体", 8),
        ("AI测评", 15), ("AI工具", 15), ("AI产品", 15), ("大模型", 10),
        ("deepseek", 10), ("chatgpt", 10), ("openai", 10), ("kimi", 8),
        ("claude", 8), ("豆包", 8), ("访谈", 6), ("盘点", 5),
    ],
    "AI网课/教程": [
        ("教程", 8), ("网课", 10), ("入门", 6), ("实战", 6),
        ("从零", 8), ("手把手", 8), ("课程", 5), ("学习", 4),
        ("吴恩达", 10), ("李宏毅", 10), ("深度学习", 6), ("机器学习", 6),
    ],
    "编程/计算机": [
        ("编程", 8), ("程序员", 8), ("代码", 6), ("开发", 5), ("软件", 5),
        ("算法", 8), ("数据结构", 10), ("Python", 8), ("Java", 8),
        ("C++", 8), ("前端", 8), ("后端", 8), ("Web", 5), ("计算机", 6),
        ("Linux", 8), ("Git", 6), ("数据库", 8), ("网络安全", 10),
        ("黑客", 6), ("leetcode", 10), ("刷题", 5), ("ACM", 10),
    ],
    "数学/物理": [
        ("数学/物理分析", 10), ("高等代数", 10), ("抽象代数", 10), ("数论", 10),
        ("实变函数", 10), ("泛函分析", 10), ("微分几何", 10), ("拓扑", 10),
        ("代数几何", 10), ("测度论", 10), ("复变函数", 10),
        ("3Blue1Brown", 10),
    ],
    "数码/科技/汽车": [
        ("数码", 8), ("手机", 6), ("电脑", 5), ("硬件", 8), ("测评", 6),
        ("评测", 6), ("苹果", 5), ("iPhone", 6), ("华为", 5), ("小米", 5),
        ("显卡", 8), ("CPU", 8), ("芯片", 6), ("拆机", 8), ("开箱", 5),
        # 汽车相关
        ("汽车", 10), ("新能源", 8), ("电动车", 8), ("特斯拉", 10), ("比亚迪", 10),
        ("理想", 6), ("蔚来", 8), ("小鹏", 8), ("自动驾驶", 10), ("试驾", 10),
        ("车评", 10), ("提车", 8),
    ],
    "电气/电子/自动化": [
        ("电气", 10), ("电子", 6), ("电路", 8), ("电力", 8), ("通信", 6),
        ("信号", 6), ("控制", 5), ("PLC", 10), ("嵌入式", 10),
        ("单片机", 10), ("Arduino", 10), ("树莓派", 8), ("自动化", 6),
        ("半导体", 10), ("模拟电路", 10), ("数字电路", 10),
        ("机器人", 10), ("robomaster", 15), ("机甲大师", 15),
        ("人形机器人", 15), ("具身智能", 10), ("MOS管", 8), ("无刷电机", 8),
    ],
    "时政/地缘政治": [
        ("时政", 10), ("地缘", 10), ("中美", 10), ("俄罗斯", 8),
        ("国际", 5), ("外交", 8), ("政策", 5), ("局势", 8),
        ("观察者", 8), ("时事", 8), ("军事", 8), ("台海", 10),
    ],
    "财经/金融": [
        ("财经", 10), ("金融", 10), ("投资", 8), ("理财", 8), ("股票", 10),
        ("基金", 8), ("经济", 6), ("商业", 5), ("创业", 5), ("A股", 10),
        ("美股", 10), ("比特币", 8), ("虚拟货币", 8),
    ],
    # 效率工具关键词合并到校园生活
    "校园生活/校园日常": [
        ("study with me", 10), ("陪伴学习", 10), ("自习室", 8),
        ("学习vlog", 10), ("读博", 8), ("博士生", 6), ("研究生", 5),
        ("留学", 8), ("校园", 8), ("大学生", 6), ("宿舍", 6),
        # 效率工具关键词
        ("Obsidian", 10), ("Notion", 10), ("笔记", 6), ("效率", 8),
        ("生产力", 8), ("知识管理", 10), ("PKM", 10), ("第二大脑", 10),
    ],
    "形象提升/医美": [
        ("医美", 10), ("整形", 10), ("穿搭", 8), ("形象", 6), ("变帅", 8),
        ("护肤", 6), ("发型", 6), ("五官", 8), ("脸型", 8), ("审美", 5),
    ],
    "两性情感": [
        ("两性", 10), ("恋爱", 8), ("婚姻", 8), ("婚恋", 10), ("感情", 5),
        ("捞女", 10), ("龟男", 10), ("相亲", 8), ("约会", 6), ("人性", 5),
        ("男女关系", 10), ("情感咨询", 10), ("国男", 10), ("女权", 8),
        ("丈夫", 6), ("妻子", 6), ("性别", 6), ("incel", 10),
    ],
    "户外探索": [
        ("徒步", 10), ("登山", 10), ("雪山", 10), ("攀岩", 10),
        ("探险", 8), ("穿越", 6), ("露营", 6), ("荒野", 10),
        ("风光", 6), ("地理", 6), ("国家地理", 10),
    ],
    "美食/探店": [
        ("美食", 8), ("探店", 10), ("吃播", 10), ("做饭", 6),
        ("餐厅", 6), ("小吃", 6), ("厨师", 8), ("菜谱", 8),
    ],
    "音乐/乐器": [
        ("钢琴", 10), ("吉他", 10), ("小提琴", 10), ("乐器", 8),
        ("演奏", 8), ("弹唱", 8), ("音乐", 5), ("歌手", 6),
        ("Vocal", 10), ("K-pop", 10), ("翻唱", 8), ("LIVE", 5),
        ("音乐现场", 8), ("歌手2026", 10),
    ],
    "影视/动漫": [
        ("电影", 8), ("影视", 8), ("剧", 5), ("动漫", 8),
        ("番剧", 10), ("解说", 5), ("影评", 8),
    ],
    "医学/健康": [
        ("医学", 10), ("健康", 6), ("医生", 8), ("疾病", 8),
        ("营养", 8), ("健身", 6), ("运动", 5), ("科普", 4),
    ],
    "美女/颜值": [
        ("美女", 10), ("小姐姐", 10), ("颜值", 10), ("甜妹", 10),
        ("萌妹", 10), ("可爱", 5), ("jk", 8), ("日系", 6),
        ("cosplay", 8), ("coser", 8), ("舞蹈", 5), ("跳舞", 6),
    ],
    "科普/人文": [
        ("科普", 8), ("冷知识", 8), ("脑洞", 6), ("实验", 5),
        ("原理", 5), ("为什么", 4),
        # 人文历史（不含时政）
        ("历史", 8), ("古代", 6), ("近代", 6), ("朝代", 8), ("皇帝", 6),
        ("战国", 8), ("三国", 6), ("唐宋", 8), ("明清", 8), ("民国", 8),
        ("文化", 5), ("传统", 5), ("哲学", 8), ("人文", 6), ("文学", 6),
        ("考古", 10), ("纪录片", 5),
    ],
    "生活": [
        ("Vlog", 5), ("日常", 4), ("生活记录", 5),
        ("旅行", 5), ("旅游", 5), ("宠物", 6), ("猫", 4), ("狗", 4),
        ("搞笑", 5), ("鬼畜", 6), ("娱乐", 4),
    ],
}


def calculate_category_scores(up_info):
    """计算每个分类的得分"""
    scores = {cat: 0 for cat in CATEGORIES}

    # 收集所有文本
    texts = []
    texts.append(up_info.get("sign", "") or "")
    texts.append(up_info.get("official_verify", "") or "")
    texts.extend(up_info.get("channels", []))
    texts.extend(up_info.get("series", []))
    texts.extend(up_info.get("video_titles", []))
    texts.extend(up_info.get("tags", []))
    texts.extend(up_info.get("articles", []))

    combined_text = " ".join(texts).lower()

    # 视频分区（最重要的判断依据之一）
    video_zones = up_info.get("video_zones", [])
    zones_text = " ".join(video_zones).lower()

    # 根据分区直接加分（完善版）
    zone_mapping = {
        "美女/颜值": ["舞蹈", "宅舞", "翻跳", "街舞", "明星舞蹈", "中国舞"],
        "音乐/乐器": ["音乐", "翻唱", "原创音乐", "演奏", "电音", "说唱", "音乐现场"],
        "影视/动漫": ["影视", "电影", "电视剧", "动画", "番剧", "国创", "综艺", "影视杂谈"],
        "数码/科技/汽车": ["数码", "手机", "电脑", "硬件", "软件应用", "汽车", "汽车生活", "汽车文化", "购车攻略"],
        "生活": ["生活", "日常", "vlog", "手工", "绘画", "摄影", "家居房产"],
        "编程/计算机": ["野生技术协会", "计算机技术"],
        "科普/人文": ["科学科普", "社科人文", "社科·法律·心理", "人文历史"],
        "时政/地缘政治": ["时事", "军事", "环球"],
        "财经/金融": ["财经", "财经商业", "商业"],
        "医学/健康": ["健康", "运动", "健身"],
        "户外探索": ["旅行", "户外", "出行"],
        "电气/电子/自动化": ["科工机械", "极客DIY"],
        "美食/探店": ["美食", "美食制作", "美食侦探", "美食测评"],
    }

    for category, zone_keywords in zone_mapping.items():
        for kw in zone_keywords:
            if kw in zones_text:
                scores[category] += 50  # 分区匹配权重很高

    # ========== 名称特征识别（高优先级）==========
    name = up_info.get("name", "").lower()

    # 机器人相关 → 电气/电子/自动化
    if any(kw in name for kw in ["机器人", "robomaster", "战队"]):
        scores["电气/电子/自动化"] += 80

    # 半导体相关 → 电气/电子/自动化
    if "半导体" in name:
        scores["电气/电子/自动化"] += 80

    # 大学官方号 → 校园生活（通过官方认证判断）
    official = up_info.get("official_verify", "") or ""
    if "大学" in official and "官方" in official:
        scores["校园生活/校园日常"] += 100

    # 招聘号 → 生活
    if "招聘" in name:
        scores["生活"] += 80

    # AI测评/AI工具 → AI产品（而非编程）
    sign = up_info.get("sign", "") or ""
    if "ai测评" in combined_text or "ai工具" in combined_text or "ai产品" in combined_text:
        scores["AI产品/开源/新闻"] += 60
        scores["编程/计算机"] -= 30  # 降低编程分数

    # 计算每个分类的得分
    for category, keywords in KEYWORD_RULES.items():
        for keyword, weight in keywords:
            count = len(re.findall(re.escape(keyword.lower()), combined_text))
            if count > 0:
                scores[category] += weight * min(count, 5)

    return scores


def classify_up(up_info):
    """分类单个UP主"""
    name = up_info.get("name", "")

    # 1. 手动指定优先
    if name in MANUAL:
        return MANUAL[name], "手动指定"

    # 2. 计算分数
    scores = calculate_category_scores(up_info)

    # 3. 找最高分
    max_score = max(scores.values())
    if max_score == 0:
        return "生活", "无明确特征，默认归类"

    best_category = max(scores, key=scores.get)

    # 4. 生成理由
    reason_parts = []
    sign = up_info.get("sign", "") or ""
    if sign:
        reason_parts.append(f"签名含'{sign[:30]}..'" if len(sign) > 30 else f"签名'{sign}'")

    channels = up_info.get("channels", [])
    if channels:
        reason_parts.append(f"合集有{channels[:3]}")

    tags = up_info.get("tags", [])[:5]
    if tags:
        reason_parts.append(f"标签含{tags}")

    reason = "；".join(reason_parts) if reason_parts else f"综合分析得分最高"

    return best_category, reason


# ========== 执行分类 ==========
results = {cat: [] for cat in CATEGORIES}

for up in uploaders:
    category, reason = classify_up(up)
    results[category].append({
        "name": up["name"],
        "mid": up["mid"],
        "reason": reason
    })

# 统计
print("\n分类统计:")
for cat in CATEGORIES:
    count = len(results[cat])
    if count > 0:
        print(f"  {cat}: {count}")

# 移除空分类
results = {k: v for k, v in results.items() if v}

# 按数量排序
sorted_results = dict(sorted(results.items(), key=lambda x: (-len(x[1]), x[0])))

# 保存JSON
output = {"categories": sorted_results}
with open(data_path / "分类结果.json", "w", encoding="utf-8") as f:
    json.dump(output, f, ensure_ascii=False, indent=2)

# 保存Markdown
total = sum(len(ups) for ups in sorted_results.values())
with open(data_path / "分类结果.md", "w", encoding="utf-8") as f:
    f.write("# B站关注UP主分类结果\n\n")
    f.write(f"总计: {total} 个UP主，{len(sorted_results)} 个分类\n\n")
    f.write("---\n\n")

    for category, ups in sorted_results.items():
        f.write(f"## {category} ({len(ups)}个)\n\n")
        for up in sorted(ups, key=lambda x: x["name"]):
            mid = up.get("mid", "")
            f.write(f"- [{up['name']}](https://space.bilibili.com/{mid})\n")
        f.write("\n")

print(f"\n完成！共 {total} 个UP主，{len(sorted_results)} 个分类")
print(f"结果保存到: 分类结果.json, 分类结果.md")
